<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #000;
        }

        #wallpaper-canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <canvas id="wallpaper-canvas"></canvas>
    <script>
        const canvas = document.getElementById('wallpaper-canvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        
        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        });

        class Particle {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2 + 0.5;
                this.speedX = (Math.random() - 0.5) * 0.3;
                this.speedY = (Math.random() - 0.5) * 0.3;
                this.opacity = Math.random() * 0.4 + 0.1;
            }
            
            update(speed) {
                this.x += this.speedX * speed;
                this.y += this.speedY * speed;
                
                if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
                    this.reset();
                }
            }
            
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Blob {
            constructor(color, index, total) {
                this.color = color;
                this.angle = (index / total) * Math.PI * 2;
                this.radius = Math.min(width, height) * 0.35;
                this.speed = 0.0005 + Math.random() * 0.0005;
                this.offset = Math.random() * Math.PI * 2;
                this.radiusVariation = Math.random() * 0.5 + 0.5;
            }
            
            update(time, intensity) {
                this.angle += this.speed;
                this.x = width / 2 + Math.cos(this.angle + this.offset) * this.radius;
                this.y = height / 2 + Math.sin(this.angle + this.offset) * this.radius;
                this.currentRadius = (Math.sin(time * 0.0008 + this.offset) * 0.5 + 0.5) * 200 * intensity * this.radiusVariation;
            }
            
            draw() {
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.currentRadius
                );
                
                gradient.addColorStop(0, this.color + 'cc');
                gradient.addColorStop(0.5, this.color + '66');
                gradient.addColorStop(1, this.color + '00');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
            }
        }

        let currentTheme = 'bloom';
        let particles = [];
        let blobs = [];
        let isAnimating = true;
        let speed = 5;
        let intensity = 5;
        
        const themes = {
            bloom: {
                colors: ['#0078d4', '#00bcf2', '#b146c2', '#881798'],
                bgColor: '#0a0a0a',
                particleCount: 80
            },
            aurora: {
                colors: ['#00d4aa', '#0078d4', '#7b68ee', '#ff6b6b'],
                bgColor: '#000510',
                particleCount: 120
            },
            abstract: {
                colors: ['#667eea', '#764ba2', '#f093fb', '#4facfe'],
                bgColor: '#0f0f0f',
                particleCount: 60
            },
            dark: {
                colors: ['#1a1a2e', '#16213e', '#0f3460', '#533483'],
                bgColor: '#000000',
                particleCount: 150
            },
            particles: {
                colors: ['#ffffff'],
                bgColor: '#000000',
                particleCount: 300
            }
        };

        function initTheme(themeName) {
            const theme = themes[themeName];
            particles = Array.from({ length: theme.particleCount }, () => new Particle());
            blobs = theme.colors.map((color, i) => new Blob(color, i, theme.colors.length));
        }

        function animate() {
            if (!isAnimating) return;
            
            const time = Date.now();
            const theme = themes[currentTheme];
            
            ctx.fillStyle = theme.bgColor;
            ctx.fillRect(0, 0, width, height);
            
            if (currentTheme !== 'particles') {
                ctx.filter = 'blur(80px)';
                ctx.globalCompositeOperation = 'lighter';
                
                blobs.forEach(blob => {
                    blob.update(time, intensity / 5);
                    blob.draw();
                });
                
                ctx.filter = 'none';
                ctx.globalCompositeOperation = 'source-over';
            }
            
            ctx.globalCompositeOperation = 'lighter';
            particles.forEach(particle => {
                particle.update(speed / 5);
                particle.draw();
            });
            ctx.globalCompositeOperation = 'source-over';
            
            requestAnimationFrame(animate);
        }

        if (window.electronAPI) {
            window.electronAPI.onChangeTheme((theme) => {
                currentTheme = theme;
                initTheme(currentTheme);
            });

            window.electronAPI.onUpdateSettings((settings) => {
                speed = settings.speed;
                intensity = settings.intensity;
            });

            window.electronAPI.onToggleAnimation(() => {
                isAnimating = !isAnimating;
                if (isAnimating) animate();
            });
        }

        initTheme(currentTheme);
        animate();
    </script>
</body>
</html>